# How to run (macOS)

`cd thisdir`

`cd psql && psql -f schemal.sql && cd ..`

`yarn && yarn dev`

It's using graphql-yoga for simplicity. Configuration of apollo-server, apollo-engine, etc. is out of the scope of this example.

Switching between them is very simple (graphql-yoga is built on top of apollo-server) and there are a lot of docs online.

# What's happening?

Custom runtime code and postgraphile config are on the ./src/binding folder.

Custom scripts are on the ./src/scripts folder.

The other folders are either generated or the graphql resolvers for the server.

To generate the types and bindings there are 4 steps.

To run them:

`yarn step1 && yarn step2 && yarn step3`

then make the hand fix.

## Step 1

> ts-node src/scripts/genSchema.ts

This will download the schema from postgraphile and save it to a .graphql file. (./src/generated/schema.graphql)

## Step 2

> graphql-binding --language typescript --input src/binding/index.ts --outputBinding src/generated/binding.ts

This will generate the binding API for the schema generated by postgraphile. (./src/generated/binding.ts)

## Step 3

> CODEGEN_ENUMS_AS_TYPES=TRUE gql-gen --require ts-node/register --template typescript --schema ./src/scripts/importSchema.ts --out ./src/generated/

This will generate the resolvers types (./src/generated/types.ts) for what we defined on the front schema (./src/schema.graphql) so that we're sure the implementation is correct.

This front schema imports data from the generated one (./src/generated/schema.graphql) so that we don't have to write them again.

## Step 4 - Hand fix

This issue is being tracked here: https://github.com/graphql-binding/graphql-binding/issues/141

On ./src/generated/binding.ts, change

```typescript
export interface BindingConstructor<T> {
  new (...args): T;
}
```

to

```typescript
export interface BindingConstructor<T> {
  new (...args: any[]): T;
}
```
